"use strict";var Timetable=function(){this.scope={hourStart:9,hourEnd:17},this.intervalPeriod=60,this.locations=[],this.events=[]};Timetable.Renderer=function(t){if(!(t instanceof Timetable))throw new Error("Initialize renderer using a Timetable");this.timetable=t},function(){function t(t,n){return e(t)&&e(n)}function e(t){return n(t)&&o(t)}function n(t){return t===parseInt(t,10)}function o(t){return t>=0&&t<24}function r(t,e){return e.indexOf(t)!==-1}function i(t,e){var n=t instanceof Date&&e instanceof Date,o=t<e;return n&&o}function a(t,e){return e>=t?e-t:24+e-t}function l(t){for(;t.firstChild;)t.removeChild(t.firstChild)}function c(t){var e=Math.round(60*(t-Math.floor(t))),n=e<10?"0":"",o=t<10?"0":"";return o+Math.floor(t)+":"+n+e}Timetable.prototype={setIntervalPeriod:function(t){if(t>60||0===t)throw new Error("Timetable interval should be an integer 1 to 60");return this.intervalPeriod=t,this},setScope:function(e,n){if(!t(e,n))throw new RangeError("Timetable scope should consist of (start, end) in whole hours from 0 to 23");return this.scope.hourStart=e,this.scope.hourEnd=n,this},addLocations:function(t){function e(){return t instanceof Array}var n=this.locations;if(!e())throw new Error("Tried to add locations in wrong format");return t.forEach(function(t){if(r(t,n))throw new Error("Location already exists");n.push(t)}),this},addEvent:function(t,e,n,o,a){if(!r(e,this.locations))throw new Error("Unknown location");if(!i(n,o))throw new Error("Invalid time range: "+JSON.stringify([n,o]));var l="[object Object]"===Object.prototype.toString.call(a);return this.events.push({name:t,location:e,startDate:n,endDate:o,options:l?a:void 0}),this}},Timetable.Renderer.prototype={draw:function(t){function e(t){if(null===t)throw new Error("Timetable container not found")}function n(t){var e=t.appendChild(document.createElement("aside")),n=e.appendChild(document.createElement("ul"));o(n)}function o(t){for(var e=0;e<m.locations.length;e++){var n=t.appendChild(document.createElement("li")),o=n.appendChild(document.createElement("span"));o.className="row-heading",o.textContent=m.locations[e]}}function r(t){var e=t.appendChild(document.createElement("section")),n=i(e),o=e.appendChild(document.createElement("time"));o.className="syncscroll",o.setAttribute("name","scrollheader");var r=n.scrollWidth+"px";s(o,r)}function i(e){var n=e.appendChild(document.createElement("header"));n.className="syncscroll",n.setAttribute("name","scrollheader");for(var o=n.appendChild(document.createElement("ul")),r=!1,i=!1,a=m.intervalPeriod,l=m.scope.hourStart;!r;){var s=o.appendChild(document.createElement("li")),d=s.appendChild(document.createElement("span"));if(d.className="time-label",d.textContent=c(l),Math.floor(l)===m.scope.hourEnd&&l!==m.scope.hourEnd){var u=document.querySelectorAll(t+" time header ul li"),h=l-a/60,f=u[0].offsetWidth,p=(Math.floor(l)-h)/(a/60),v=f*p,E=u.length-2;u[E].style.width=v+"px",l=Math.floor(l),v<f/2&&(d.textContent="")}Math.floor(l)!==m.scope.hourEnd||m.scope.hourStart===m.scope.hourEnd&&!i||(r=!0),l+=a/60,24===Math.floor(l)&&(l=0,i=!0)}return n}function s(t,e){var n=t.appendChild(document.createElement("ul"));n.style.width=e,n.className="room-timeline";for(var o=0;o<m.locations.length;o++){var r=n.appendChild(document.createElement("li"));d(m.locations[o],r)}}function d(t,e){for(var n=0;n<m.events.length;n++){var o=m.events[n];o.location===t&&u(o,e)}}function u(t,e){var n,o,r,i=void 0!==t.options,a=!1;i&&(n=void 0!==t.options.url,o=void 0!==t.options["class"],r=void 0!==t.options.data,a=void 0!==t.options.onClick);var l=n?"a":"span",c=e.appendChild(document.createElement(l)),s=c.appendChild(document.createElement("small"));if(c.title=t.name,n&&(c.href=t.options.url),r)for(var d in t.options.data)c.setAttribute("data-"+d,t.options.data[d]);a&&c.addEventListener("click",function(e){t.options.onClick(t,m,e)}),c.className=o?"time-entry "+t.options["class"]:"time-entry",c.style.width=h(t),c.style.left=p(t),s.textContent=t.name}function h(t){var e=t.startDate,n=t.endDate,o=f(e,n);return o/v*100+"%"}function f(t,e){return(e.getTime()-t.getTime())/1e3/60/60}function p(t){var e=m.scope.hourStart,n=t.startDate.getHours()+t.startDate.getMinutes()/60,o=a(e,n);return o/v*100+"%"}var m=this.timetable,v=a(m.scope.hourStart,m.scope.hourEnd),E=document.querySelector(t);e(E),l(E),n(E),r(E),syncscroll.reset()}}}();